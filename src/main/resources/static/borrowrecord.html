<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å€Ÿé˜…è®°å½• - å›¾ä¹¦å€Ÿé˜…ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th, td {
            padding: 15px;
            text-align: center;
            vertical-align: middle;
        }

        th {
            background-color: #3498db;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #ecf0f1;
        }

        .btn.back {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .btn.back:hover {
            background-color: #2980b9;
        }
        
        /* åˆ†é¡µæ ·å¼ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
        
        .btn {
            background-color: #3498db;
            color: white;
            padding: 8px 16px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 0 10px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .page-info {
            font-size: 16px;
            margin: 0 15px;
            min-width: 80px;
            text-align: center;
        }
        /* é¡µé¢ä¸»ä½“èƒŒæ™¯ä¼˜åŒ– */
        body {
            margin: 0;
            padding-top: 70px; /* ä¸ºå›ºå®šå¯¼èˆªæ ç•™å‡ºç©ºé—´ */
            background: url('/icons/img_2.png') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
        }
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 999;
        }
        .navbar-brand {
            position: relative;
            font-size: 24px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: #333;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            height: 50px;
        }
    </style>
</head>
<body>
    <!-- å›ºå®šå¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-brand">ğŸ“˜ å›¾ä¹¦å€Ÿé˜…ç³»ç»Ÿ</div>
        <div class="nav-links">
        </div>
    </nav>

    <div class="container">
        <h1>ğŸ“š å€Ÿé˜…è®°å½•</h1>
        
        <a href="index.html">
            <button class="btn back">è¿”å›é¦–é¡µ</button>
        </a>

        <div class="card">
            <table id="borrowTable">
                <thead>
                    <tr>
                        <th>å€Ÿé˜…ID</th>
                        <th>ç”¨æˆ·ID</th>
                        <th>å›¾ä¹¦åç§°</th>
                        <th>å€Ÿé˜…æ—¥æœŸ</th>
                        <th>å½’è¿˜æ—¥æœŸ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- åŠ¨æ€æ’å…¥æ•°æ® -->
                </tbody>
            </table>
        </div>
        
        <!-- åˆ†é¡µæ§ä»¶ -->
        <div class="pagination">
            <button id="prevPage" class="btn">ä¸Šä¸€é¡µ</button>
            <span id="pageInfo" class="page-info"></span>
            <button id="nextPage" class="btn">ä¸‹ä¸€é¡µ</button>
        </div>
    </div>

    <script>
        // åˆ†é¡µé…ç½®
        const PAGE_SIZE = 5;
        let currentPage = 1;
        let totalPages = 1;
        let allBooks = [];
        let currentCategory = null;
        
        // åˆå§‹åŒ–åˆ†é¡µäº‹ä»¶ç›‘å¬
        function initPagination() {
            document.getElementById('prevPage').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    fetchBorrowRecords(currentPage);
                }
            });
        
            document.getElementById('nextPage').addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    fetchBorrowRecords(currentPage);
                }
            });
        }
        
        // è·å–å€Ÿé˜…è®°å½•
        async function fetchBorrowRecords(page = 1) {
            const BORROW_API_URL = `http://localhost:8080/borrow?page=${page}&size=${PAGE_SIZE}`;
            
            try {
                const res = await fetch(BORROW_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!res.ok) throw new Error('è·å–å¤±è´¥');
                
                const data = await res.json();
                totalPages = Math.ceil(data.length / PAGE_SIZE);
                currentPage = page;
                
                // æ›´æ–°é¡µé¢ä¿¡æ¯
                document.getElementById('pageInfo').textContent = `ç¬¬ ${currentPage} é¡µ / å…± ${totalPages} é¡µ`;
                
                renderRecords(data);
            } catch (error) {
                console.error('é”™è¯¯:', error);
                document.getElementById('borrowTable').innerHTML =
                    `<tr><td colspan="5" class="no-books">æ•°æ®åŠ è½½å¤±è´¥</td></tr>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–å€Ÿé˜…è®°å½•
        window.onload = async function() {
            // åˆå§‹åŒ–åˆ†é¡µ
            initPagination();
            
            // åŠ è½½ç¬¬ä¸€é¡µæ•°æ®
            await fetchBorrowRecords(currentPage);
            const BORROW_API_URL = 'http://localhost:8080/borrow';
            try {
                const res1={
                    id:1,
                    bookId:"",
                    bookTitle:"",
                    borrowDate:"",
                    returnDate:""
                };
                const res = await fetch(BORROW_API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({res1})});
                if (!res.ok) throw new Error('è·å–å¤±è´¥');
                const records = await res.json();
                renderRecords(records);
            } catch (error) {
                console.error('é”™è¯¯:', error);
                document.getElementById('borrowTable').innerHTML =
                    `<tr><td colspan="5" class="no-books">æ•°æ®åŠ è½½å¤±è´¥</td></tr>`;
            }
        }
        // æ¸²æŸ“å€Ÿé˜…è®°å½•è¡¨æ ¼
        function renderRecords(records) {
            const tbody = document.querySelector('#borrowTable tbody');
            tbody.innerHTML = '';
            
            if (!records || records.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="no-books">æš‚æ— å€Ÿé˜…è®°å½•</td></tr>`;
                return;
            }
            totalPages = Math.ceil(records.length / PAGE_SIZE);
            const startIdx = (currentPage - 1) * PAGE_SIZE;
            const endIdx = Math.min(startIdx + PAGE_SIZE, records.length);
            const paginatedrecords = records.slice(startIdx, endIdx);
            paginatedrecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.id}</td>
                    <td>${record.bookId}</td>
                    <td>${record.bookTitle?record.bookTitle:"æš‚æ— ä¹¦ç±"}</td>
                    <td>${new Date(record.borrowDate).toLocaleDateString()}</td>
                    <td>${record.returnDate?record.returnDate:"æœªå½’è¿˜"}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>